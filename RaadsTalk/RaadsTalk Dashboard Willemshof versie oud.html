<html>

<!-- DEZE VERSIE KAN JE IN DE BROWSER BEKIJKEN, ALLES TUSSEN DE HTML BRACKETS STAAT OP DE WILLEMSHOF  -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js">
	// JQuery library, nodig voor goede requests en verwijzingen over de pagina.
</script> 
<script src="https://d3js.org/d3.v3.min.js">
	// D3 Library, nodig voor de visualisaties
</script> 
<script type="text/javascript">
	// Groot stuk code dat gekopieerd is. nodig voor een klein stukje functionaliteit, namelijk het doorklikken naar zoek.openraadsinformatie.nl met de juist zoekparameters

	// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>
	// This work is free. You can redistribute it and/or modify it
	// under the terms of the WTFPL, Version 2
	// For more information see LICENSE.txt or http://www.wtfpl.net/
	//
	// For more information, the home page:
	// http://pieroxy.net/blog/pages/lz-string/testing.html
	//
	// LZ-based compression algorithm, version 1.4.4
	var LZString = (function() {

	// private property
	var f = String.fromCharCode;
	var keyStrBase64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
	var keyStrUriSafe = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$";
	var baseReverseDic = {};

	function getBaseValue(alphabet, character) {
	  if (!baseReverseDic[alphabet]) {
	    baseReverseDic[alphabet] = {};
	    for (var i=0 ; i<alphabet.length ; i++) {
	      baseReverseDic[alphabet][alphabet.charAt(i)] = i;
	    }
	  }
	  return baseReverseDic[alphabet][character];
	}

	var LZString = {
	  compressToBase64 : function (input) {
	    if (input == null) return "";
	    var res = LZString._compress(input, 6, function(a){return keyStrBase64.charAt(a);});
	    switch (res.length % 4) { // To produce valid Base64
	    default: // When could this happen ?
	    case 0 : return res;
	    case 1 : return res+"===";
	    case 2 : return res+"==";
	    case 3 : return res+"=";
	    }
	  },

	  decompressFromBase64 : function (input) {
	    if (input == null) return "";
	    if (input == "") return null;
	    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrBase64, input.charAt(index)); });
	  },

	  compressToUTF16 : function (input) {
	    if (input == null) return "";
	    return LZString._compress(input, 15, function(a){return f(a+32);}) + " ";
	  },

	  decompressFromUTF16: function (compressed) {
	    if (compressed == null) return "";
	    if (compressed == "") return null;
	    return LZString._decompress(compressed.length, 16384, function(index) { return compressed.charCodeAt(index) - 32; });
	  },

	  //compress into uint8array (UCS-2 big endian format)
	  compressToUint8Array: function (uncompressed) {
	    var compressed = LZString.compress(uncompressed);
	    var buf=new Uint8Array(compressed.length*2); // 2 bytes per character

	    for (var i=0, TotalLen=compressed.length; i<TotalLen; i++) {
	      var current_value = compressed.charCodeAt(i);
	      buf[i*2] = current_value >>> 8;
	      buf[i*2+1] = current_value % 256;
	    }
	    return buf;
	  },

	  //decompress from uint8array (UCS-2 big endian format)
	  decompressFromUint8Array:function (compressed) {
	    if (compressed===null || compressed===undefined){
	        return LZString.decompress(compressed);
	    } else {
	        var buf=new Array(compressed.length/2); // 2 bytes per character
	        for (var i=0, TotalLen=buf.length; i<TotalLen; i++) {
	          buf[i]=compressed[i*2]*256+compressed[i*2+1];
	        }

	        var result = [];
	        buf.forEach(function (c) {
	          result.push(f(c));
	        });
	        return LZString.decompress(result.join(''));

	    }

	  },


	  //compress into a string that is already URI encoded
	  compressToEncodedURIComponent: function (input) {
	    if (input == null) return "";
	    return LZString._compress(input, 6, function(a){return keyStrUriSafe.charAt(a);});
	  },

	  //decompress from an output of compressToEncodedURIComponent
	  decompressFromEncodedURIComponent:function (input) {
	    if (input == null) return "";
	    if (input == "") return null;
	    input = input.replace(/ /g, "+");
	    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrUriSafe, input.charAt(index)); });
	  },

	  compress: function (uncompressed) {
	    return LZString._compress(uncompressed, 16, function(a){return f(a);});
	  },
	  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {
	    if (uncompressed == null) return "";
	    var i, value,
	        context_dictionary= {},
	        context_dictionaryToCreate= {},
	        context_c="",
	        context_wc="",
	        context_w="",
	        context_enlargeIn= 2, // Compensate for the first entry which should not count
	        context_dictSize= 3,
	        context_numBits= 2,
	        context_data=[],
	        context_data_val=0,
	        context_data_position=0,
	        ii;

	    for (ii = 0; ii < uncompressed.length; ii += 1) {
	      context_c = uncompressed.charAt(ii);
	      if (!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)) {
	        context_dictionary[context_c] = context_dictSize++;
	        context_dictionaryToCreate[context_c] = true;
	      }

	      context_wc = context_w + context_c;
	      if (Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)) {
	        context_w = context_wc;
	      } else {
	        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {
	          if (context_w.charCodeAt(0)<256) {
	            for (i=0 ; i<context_numBits ; i++) {
	              context_data_val = (context_data_val << 1);
	              if (context_data_position == bitsPerChar-1) {
	                context_data_position = 0;
	                context_data.push(getCharFromInt(context_data_val));
	                context_data_val = 0;
	              } else {
	                context_data_position++;
	              }
	            }
	            value = context_w.charCodeAt(0);
	            for (i=0 ; i<8 ; i++) {
	              context_data_val = (context_data_val << 1) | (value&1);
	              if (context_data_position == bitsPerChar-1) {
	                context_data_position = 0;
	                context_data.push(getCharFromInt(context_data_val));
	                context_data_val = 0;
	              } else {
	                context_data_position++;
	              }
	              value = value >> 1;
	            }
	          } else {
	            value = 1;
	            for (i=0 ; i<context_numBits ; i++) {
	              context_data_val = (context_data_val << 1) | value;
	              if (context_data_position ==bitsPerChar-1) {
	                context_data_position = 0;
	                context_data.push(getCharFromInt(context_data_val));
	                context_data_val = 0;
	              } else {
	                context_data_position++;
	              }
	              value = 0;
	            }
	            value = context_w.charCodeAt(0);
	            for (i=0 ; i<16 ; i++) {
	              context_data_val = (context_data_val << 1) | (value&1);
	              if (context_data_position == bitsPerChar-1) {
	                context_data_position = 0;
	                context_data.push(getCharFromInt(context_data_val));
	                context_data_val = 0;
	              } else {
	                context_data_position++;
	              }
	              value = value >> 1;
	            }
	          }
	          context_enlargeIn--;
	          if (context_enlargeIn == 0) {
	            context_enlargeIn = Math.pow(2, context_numBits);
	            context_numBits++;
	          }
	          delete context_dictionaryToCreate[context_w];
	        } else {
	          value = context_dictionary[context_w];
	          for (i=0 ; i<context_numBits ; i++) {
	            context_data_val = (context_data_val << 1) | (value&1);
	            if (context_data_position == bitsPerChar-1) {
	              context_data_position = 0;
	              context_data.push(getCharFromInt(context_data_val));
	              context_data_val = 0;
	            } else {
	              context_data_position++;
	            }
	            value = value >> 1;
	          }


	        }
	        context_enlargeIn--;
	        if (context_enlargeIn == 0) {
	          context_enlargeIn = Math.pow(2, context_numBits);
	          context_numBits++;
	        }
	        // Add wc to the dictionary.
	        context_dictionary[context_wc] = context_dictSize++;
	        context_w = String(context_c);
	      }
	    }

	    // Output the code for w.
	    if (context_w !== "") {
	      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {
	        if (context_w.charCodeAt(0)<256) {
	          for (i=0 ; i<context_numBits ; i++) {
	            context_data_val = (context_data_val << 1);
	            if (context_data_position == bitsPerChar-1) {
	              context_data_position = 0;
	              context_data.push(getCharFromInt(context_data_val));
	              context_data_val = 0;
	            } else {
	              context_data_position++;
	            }
	          }
	          value = context_w.charCodeAt(0);
	          for (i=0 ; i<8 ; i++) {
	            context_data_val = (context_data_val << 1) | (value&1);
	            if (context_data_position == bitsPerChar-1) {
	              context_data_position = 0;
	              context_data.push(getCharFromInt(context_data_val));
	              context_data_val = 0;
	            } else {
	              context_data_position++;
	            }
	            value = value >> 1;
	          }
	        } else {
	          value = 1;
	          for (i=0 ; i<context_numBits ; i++) {
	            context_data_val = (context_data_val << 1) | value;
	            if (context_data_position == bitsPerChar-1) {
	              context_data_position = 0;
	              context_data.push(getCharFromInt(context_data_val));
	              context_data_val = 0;
	            } else {
	              context_data_position++;
	            }
	            value = 0;
	          }
	          value = context_w.charCodeAt(0);
	          for (i=0 ; i<16 ; i++) {
	            context_data_val = (context_data_val << 1) | (value&1);
	            if (context_data_position == bitsPerChar-1) {
	              context_data_position = 0;
	              context_data.push(getCharFromInt(context_data_val));
	              context_data_val = 0;
	            } else {
	              context_data_position++;
	            }
	            value = value >> 1;
	          }
	        }
	        context_enlargeIn--;
	        if (context_enlargeIn == 0) {
	          context_enlargeIn = Math.pow(2, context_numBits);
	          context_numBits++;
	        }
	        delete context_dictionaryToCreate[context_w];
	      } else {
	        value = context_dictionary[context_w];
	        for (i=0 ; i<context_numBits ; i++) {
	          context_data_val = (context_data_val << 1) | (value&1);
	          if (context_data_position == bitsPerChar-1) {
	            context_data_position = 0;
	            context_data.push(getCharFromInt(context_data_val));
	            context_data_val = 0;
	          } else {
	            context_data_position++;
	          }
	          value = value >> 1;
	        }


	      }
	      context_enlargeIn--;
	      if (context_enlargeIn == 0) {
	        context_enlargeIn = Math.pow(2, context_numBits);
	        context_numBits++;
	      }
	    }

	    // Mark the end of the stream
	    value = 2;
	    for (i=0 ; i<context_numBits ; i++) {
	      context_data_val = (context_data_val << 1) | (value&1);
	      if (context_data_position == bitsPerChar-1) {
	        context_data_position = 0;
	        context_data.push(getCharFromInt(context_data_val));
	        context_data_val = 0;
	      } else {
	        context_data_position++;
	      }
	      value = value >> 1;
	    }

	    // Flush the last char
	    while (true) {
	      context_data_val = (context_data_val << 1);
	      if (context_data_position == bitsPerChar-1) {
	        context_data.push(getCharFromInt(context_data_val));
	        break;
	      }
	      else context_data_position++;
	    }
	    return context_data.join('');
	  },

	  decompress: function (compressed) {
	    if (compressed == null) return "";
	    if (compressed == "") return null;
	    return LZString._decompress(compressed.length, 32768, function(index) { return compressed.charCodeAt(index); });
	  },

	  _decompress: function (length, resetValue, getNextValue) {
	    var dictionary = [],
	        next,
	        enlargeIn = 4,
	        dictSize = 4,
	        numBits = 3,
	        entry = "",
	        result = [],
	        i,
	        w,
	        bits, resb, maxpower, power,
	        c,
	        data = {val:getNextValue(0), position:resetValue, index:1};

	    for (i = 0; i < 3; i += 1) {
	      dictionary[i] = i;
	    }

	    bits = 0;
	    maxpower = Math.pow(2,2);
	    power=1;
	    while (power!=maxpower) {
	      resb = data.val & data.position;
	      data.position >>= 1;
	      if (data.position == 0) {
	        data.position = resetValue;
	        data.val = getNextValue(data.index++);
	      }
	      bits |= (resb>0 ? 1 : 0) * power;
	      power <<= 1;
	    }

	    switch (next = bits) {
	      case 0:
	          bits = 0;
	          maxpower = Math.pow(2,8);
	          power=1;
	          while (power!=maxpower) {
	            resb = data.val & data.position;
	            data.position >>= 1;
	            if (data.position == 0) {
	              data.position = resetValue;
	              data.val = getNextValue(data.index++);
	            }
	            bits |= (resb>0 ? 1 : 0) * power;
	            power <<= 1;
	          }
	        c = f(bits);
	        break;
	      case 1:
	          bits = 0;
	          maxpower = Math.pow(2,16);
	          power=1;
	          while (power!=maxpower) {
	            resb = data.val & data.position;
	            data.position >>= 1;
	            if (data.position == 0) {
	              data.position = resetValue;
	              data.val = getNextValue(data.index++);
	            }
	            bits |= (resb>0 ? 1 : 0) * power;
	            power <<= 1;
	          }
	        c = f(bits);
	        break;
	      case 2:
	        return "";
	    }
	    dictionary[3] = c;
	    w = c;
	    result.push(c);
	    while (true) {
	      if (data.index > length) {
	        return "";
	      }

	      bits = 0;
	      maxpower = Math.pow(2,numBits);
	      power=1;
	      while (power!=maxpower) {
	        resb = data.val & data.position;
	        data.position >>= 1;
	        if (data.position == 0) {
	          data.position = resetValue;
	          data.val = getNextValue(data.index++);
	        }
	        bits |= (resb>0 ? 1 : 0) * power;
	        power <<= 1;
	      }

	      switch (c = bits) {
	        case 0:
	          bits = 0;
	          maxpower = Math.pow(2,8);
	          power=1;
	          while (power!=maxpower) {
	            resb = data.val & data.position;
	            data.position >>= 1;
	            if (data.position == 0) {
	              data.position = resetValue;
	              data.val = getNextValue(data.index++);
	            }
	            bits |= (resb>0 ? 1 : 0) * power;
	            power <<= 1;
	          }

	          dictionary[dictSize++] = f(bits);
	          c = dictSize-1;
	          enlargeIn--;
	          break;
	        case 1:
	          bits = 0;
	          maxpower = Math.pow(2,16);
	          power=1;
	          while (power!=maxpower) {
	            resb = data.val & data.position;
	            data.position >>= 1;
	            if (data.position == 0) {
	              data.position = resetValue;
	              data.val = getNextValue(data.index++);
	            }
	            bits |= (resb>0 ? 1 : 0) * power;
	            power <<= 1;
	          }
	          dictionary[dictSize++] = f(bits);
	          c = dictSize-1;
	          enlargeIn--;
	          break;
	        case 2:
	          return result.join('');
	      }

	      if (enlargeIn == 0) {
	        enlargeIn = Math.pow(2, numBits);
	        numBits++;
	      }

	      if (dictionary[c]) {
	        entry = dictionary[c];
	      } else {
	        if (c === dictSize) {
	          entry = w + w.charAt(0);
	        } else {
	          return null;
	        }
	      }
	      result.push(entry);

	      // Add w+entry[0] to the dictionary.
	      dictionary[dictSize++] = w + entry.charAt(0);
	      enlargeIn--;

	      w = entry;

	      if (enlargeIn == 0) {
	        enlargeIn = Math.pow(2, numBits);
	        numBits++;
	      }

	    }
	  }
	};
	  return LZString;
	})();

	if (typeof define === 'function' && define.amd) {
	  define(function () { return LZString; });
	} else if( typeof module !== 'undefined' && module != null ) {
	  module.exports = LZString
	} else if( typeof angular !== 'undefined' && angular != null ) {
	  angular.module('LZString', [])
	  .factory('LZString', function () {
	    return LZString;
	  });
	}
</script>
<style>
body {
    font-family: "Source-Sans-Pro", "Segoe UI Semilight", "Segoe UI", "Segoe", Tahoma, Helvetica, Arial, sans-serif;
    font-size: 15px;
    font-weight: 400;
    line-height: 1.47;
    color: #6d6e70;
  }

  .wrapper {
    width:560px; 
    margin:0 auto;
  }

  .info {
    padding-left: 10px;
    padding-top: 10px;
  }

  .sorteerbuttons {
    padding-left: 10px;
    padding-top: 5px;
  }

  .button {
    background-color: #00ACEC; 
    border: none;
    color: white;
    text-align: center;
    display: inline-block;
    font-weight: bold;
    cursor: pointer;
    width: 80px;
    padding: 2px 2px 2px 2px;

  }

  .contentTitle {
    margin: 0 0 12.9px 0;
    font-family: "Source-Sans-Pro", "Segoe UI Semilight", "Segoe UI", "Segoe", Tahoma, Helvetica, Arial, sans-serif;
    font-size: 17px;
    font-weight: 400;
    line-height: 1.18;
    color: #003767;
  }

  .contentText {
    margin: 0 0 20.9px 0;
    font-family: "Source-Sans-Pro", "Segoe UI Semilight", "Segoe UI", "Segoe", Tahoma, Helvetica, Arial, sans-serif;
    font-size: 15px;
    font-weight: 400;
    line-height: 1.47;
    color: #6d6e70;
  }

  .mainGroup {
    font-size: 16px;
    cursor:pointer;
    text-decoration: underline;
  }


  #loader {
    position: absolute;
    left: 50%;
    top: 50%;
    z-index: 1;
    width: 150px;
    height: 150px;
    margin: -75px 0 0 -75px;
    border: 16px solid #f3f3f3;
    border-radius: 50%;
    border-top: 16px solid #3498db;
    width: 120px;
    height: 120px;
    -webkit-animation: spin 2s linear infinite;
    animation: spin 2s linear infinite;
  }

  @-webkit-keyframes spin {
    0% { -webkit-transform: rotate(0deg); }
    100% { -webkit-transform: rotate(360deg); }
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  line {
        fill: none;
        font: 14px sans-serif;
      }

  .x.axis line {
    fill: none;
    stroke: #e0e0e0;
    shape-rendering: crispEdges;
  }

  .axis path {
    display: none;
  }

  .brush .extent {
    fill-opacity: 0.125;
    shape-rendering: crispEdges;
  }

  .resize {
    display: inline !important; /* show when empty */
    fill: #7A7A7A;
    fill-opacity: 0.125;
    stroke: #7A7A7A;
    stroke-width: 2px;
  }

  #Onderwerpenlijst{
   margin-top: 3px;
   margin-bottom: 3px;
   width:150px;   
  }

  #VrijZoeken{
   margin-top: 3px;
   margin-bottom: 3px;
   width:138px;   /*beetje onduidelijk waarom, maar dit leidt tot zoekvelden met gelijke lengte */
  }

  .date{
  	width:120px;
  }

div.select1 {
    border:2px solid black;
    padding: 10px 0px 5px 5px;
    background: #e5ebef;
    font-family: "Source-Sans-Pro", "Segoe UI Semilight", "Segoe UI", "Segoe", Tahoma, Helvetica, Arial, sans-serif;
    font-size: 15px;
    font-weight: 400;
    line-height: 1.47;
    color: #003767;
  }

  div.select2 {
    border:2px solid black;
    padding: 10px 10px 10px 10px;
    font-family: "Source-Sans-Pro", "Segoe UI Semilight", "Segoe UI", "Segoe", Tahoma, Helvetica, Arial, sans-serif;
    font-size: 15px;
    font-weight: 400;
    line-height: 1.47;
    color: #6d6e70;
  }

  div.select2a {
    float:left; 
    width: 150px
  }

  u {
  	cursor:pointer;
  }

  p {
  	cursor:default;
  }

  i {
  	cursor:default;
  }

  b {
  	cursor:default;
  }

  .button {
	background-color: #00ACEC; 
	border: none;
	color: white;
	text-align: center;
	display: inline-block;
	font-weight: bold;
	cursor: pointer;
	width: 80px;
	padding: 2px 2px 2px 2px;
	margin: 2px 2px 2px 2px;

</style>

<div class="wrapper">
	<div class="info">
		<p class="contentTitle">Hoe vaak wordt jouw onderwerp in de gemeenteraad besproken?</p>
		<p class="contentText">Bekijk met RaadsTalk wat er leeft in gemeenteraden in Nederland. RaadsTalk zoekt termen in raadsdocumenten van meer dan 110 gemeenten in Nederland.</p>
	</div>

	<div class="select1"> 
		Gemeente: <select id="gemeente"><option value="combined_index">Alle gemeenten</option><option value="utrecht">Utrecht</option><option value="amsterdam">Amsterdam</option><option value="katwijk">Katwijk</option></select>  
		Van: <input type="date" class="date" value="2018-01-01" id="start_date"> Tot: <input type="date" class="date" value="2019-01-01" id="end_date"> 
	</div>
	<div class="select2">
		<div class="select2a">
			<p style="margin-top: 3px;margin-bottom: 0px"><b>Onderwerpenlijst: </b></p>
			<p style="margin-top: 3px;margin-bottom: 0px"><b>Vrij zoeken: </b></p>
		</div>
		<div>
			<select name="Onderwerpenlijst" id="Onderwerpenlijst"><option value="VNG lijst 1">VNG Thema's</option><option value="VNG lijst 2">Maatschappelijke opgaven</option><option value="VNG lijst 3">VNG Realisatie</option></select><button type='button' class='button' id="OnderwerpenZoeker">ZOEKEN</button>  &nbsp;&nbsp; ------- OF -------<br>
			<input type="text" placeholder="Bijvoorbeeld: Fijnstof" id="VrijZoeken" name="VrijZoeken"><button type='button' class='button' id="VrijeZoeker">ZOEKEN</button>
		</div>
		<b>Let op! Een zoekopdracht kan best lang duren, tot wel 60 seconden.</b>
	</div>
	<div class="info">
		<p class="contentTitle">Resultaten</p>
		<p class="contentText" id="totalCount">Klik op  het onderwerp om te zien in welke gemeenteraden het onderwerp is besproken. </p>
	</div>
	<hr>
</div>

<div id="chart" style="width:560px; margin:0 auto;">
	<div class="sorteerbuttons"><b>Sorteer:</b> <u id="Aantal">Aantal</u> | <u id="Alfabetisch">Alfabetisch</u></div>
	<div>

		<div id="loader"></div>
		<script type="text/javascript">
			document.getElementById("loader").style.display = "none" 

			document.getElementById("VrijeZoeker").addEventListener("click", function(){
				document.getElementById("VrijeZoeker").disabled = true; // zo wordt een zoekopdracht afgerond voordat er een nieuwe wordt begonnen, je kan namelijk niet opnieuw zoeken.
				document.getElementById("OnderwerpenZoeker").disabled = true;   // zo wordt een zoekopdracht afgerond voordat er een nieuwe wordt begonnen, je kan namelijk niet opnieuw zoeken.
				barChartPerGemeente(document.getElementById("VrijZoeken").value, document.getElementById("start_date").value, document.getElementById("end_date").value, $("#gemeente").val());
				
			}); 
			
			var input = document.getElementById("VrijZoeken");
			// Execute a function when the user releases a key on the keyboard
			input.addEventListener("keyup", function(event) {
			// Cancel the default action, if needed
				event.preventDefault();
				// Number 13 is the "Enter" key on the keyboard
				if (event.keyCode === 13) {
				// Trigger the button element with a click
					document.getElementById("VrijeZoeker").click(function(){
						document.getElementById("VrijeZoeker").disabled = true;   // zo wordt een zoekopdracht afgerond voordat er een nieuwe wordt begonnen, je kan namelijk niet opnieuw zoeken.
						document.getElementById("OnderwerpenZoeker").disabled = true;  // zo wordt een zoekopdracht afgerond voordat er een nieuwe wordt begonnen, je kan namelijk niet opnieuw zoeken.
						barChartPerGemeente(document.getElementById("VrijZoeken").value, document.getElementById("start_date").value, document.getElementById("end_date").value, $("#gemeente").val());
					});
				}
			});

			$("#OnderwerpenZoeker").click(function(){
				document.getElementById("VrijeZoeker").disabled = true;  // zo wordt een zoekopdracht afgerond voordat er een nieuwe wordt begonnen, je kan namelijk niet opnieuw zoeken.
				document.getElementById("OnderwerpenZoeker").disabled = true;	  // zo wordt een zoekopdracht afgerond voordat er een nieuwe wordt begonnen, je kan namelijk niet opnieuw zoeken.
				barChartPerOnderwerp($("#gemeente").val(), $("#Onderwerpenlijst").val(),$("#start_date").val(), $("#end_date").val());
			});

			barChartPerOnderwerp(document.getElementById("gemeente").value, document.getElementById("Onderwerpenlijst").value,document.getElementById("start_date").value, document.getElementById("end_date").value)

			var lijstGemeenten = Array("aalsmeer","alkmaar","almelo","almere","amersfoort","amstelveen","amsterdam","arnhem","baarn","barneveld","beemster","binnenmaas","bodegravenreeuwijk","borne","boxmeer","buren","cappelleadijssel","castricum", "culemborg","den_helder","denhaag","deventer","dewolden","diemen","doetinchem","dongen","drimmelen","edamvolendam","ede","emmen","enschede","epe","ettenleur","goirle","gouda","groningen","hardenberg","heemskerk","heerde","hendrikidoambacht","hilvarenbeek","hilversum","hollandskroon","hulst","katwijk","krimpenadijssel","krimpenerwaard","landsmeer","leeuwarden","leiden","leiderdorp","leusden","lingewaard","loonopzand","losser","maassluis","maastricht","medemblik","meierijstad","meppel","moerdijk","molenwaard","nieuwegein","nieuwkoop","nijkerk","noordoostpolder","noordwijk","noordwijkerhout","oisterwijk","oldambt","ommen","oosterhout","oostgelre","oss","oude_ijsselstreek","overbetuwe","raalte","rheden","rhenen","rijswijk","roermond","roosendaal","rucphen","schagen","schiedam","soest","staphorst","steenbergen","steenwijkerland","stichtsevecht","texel","teylingen","utrecht","veenendaal","velsen","vlaardingen","vlissingen","voorschoten","voorst","waalwijk","wageningen","wassenaar","zaanstad","zandvoort","zeist","zoetermeer","zwartewaterland","zwolle")
			
			// Vul de lijst met gemeenten waar je uit kan kiezen om op te selecteren.
			var options = '<option value="combined_index">Alle gemeenten</option>';
			for (var i = 0; i < lijstGemeenten.length; i++) {
			   options += '<option value="' + lijstGemeenten[i]+ '">' + lijstGemeenten[i] + '</option>';
			}
			$("#gemeente").html(options);
				

			function barChartPerOnderwerp(gemeente, lijst,start_date, end_date){
				d3.select(".svgWrapper").remove()

				// De drie lijsten die je kan kiezen, handmatig aanpassen als je meer lijsten wil of andere termen.
				var lijst1 = Array("Bereikbaarheid","Cannabis","Energie","Gezondheidspreventie","Informatiesamenleving","Integratie nieuwkomers","Klimaat","Lokale democratie","Ondermijning","Samen Organiseren","Schuldhulpverlening","Woonbeleid");
				var lijst2 = Array("Bouwen","Digitalisering","Energie","Klimaat","Laaggeletterd ","Lokale democratie","Migratie","Mobiliteit","Schuldenproblematiek","Transformatie sociaal domein","Vitaal platteland");
				var lijst3 = Array("AVG","Bedrijfsvoering","Collectieve infrastructuur","Collectieve inkoop","Common Ground","Datagedreven","Data Science","Dienstverlening","GGI","Informatiebeveiliging","Privacy","Stuurinformatie","Taskforce")
				var queries

				getAmountBar(gemeente, lijst,start_date, end_date)

				var lijstGemeenten = Array("aalsmeer","alkmaar","almelo","almere","amersfoort","amstelveen","amsterdam","arnhem","baarn","barneveld","beemster","binnenmaas","bodegravenreeuwijk","borne","boxmeer","buren","cappelleadijssel","castricum", "culemborg","den_helder","denhaag","deventer","dewolden","diemen","doetinchem","dongen","drimmelen","edamvolendam","ede","emmen","enschede","epe","ettenleur","goirle","gouda","groningen","hardenberg","heemskerk","heerde","hendrikidoambacht","hilvarenbeek","hilversum","hollandskroon","hulst","katwijk","krimpenadijssel","krimpenerwaard","landsmeer","leeuwarden","leiden","leiderdorp","leusden","lingewaard","loonopzand","losser","maassluis","maastricht","medemblik","meierijstad","meppel","moerdijk","molenwaard","nieuwegein","nieuwkoop","nijkerk","noordoostpolder","noordwijk","noordwijkerhout","oisterwijk","oldambt","ommen","oosterhout","oostgelre","oss","oude_ijsselstreek","overbetuwe","raalte","rheden","rhenen","rijswijk","roermond","roosendaal","rucphen","schagen","schiedam","soest","staphorst","steenbergen","steenwijkerland","stichtsevecht","texel","teylingen","utrecht","veenendaal","velsen","vlaardingen","vlissingen","voorschoten","voorst","waalwijk","wageningen","wassenaar","zaanstad","zandvoort","zeist","zoetermeer","zwartewaterland","zwolle")

				function getAmountBar(gemeente, lijst,start_date, end_date) {
					document.getElementById("loader").style.display = "block"; // Laat de loader zien
					counterBar = 0;
					ValuesBar = Array();

					// Easy fix van als de velden leeg blijven, dan gewoon een punt ver in de toekomst of het verleden kiezen en zoeken naar alle termen.
					if (start_date == ""){
				  		start_date = "1980-01-01";
				  	}
				  	if (end_date == ""){
				  		end_date = "2030-01-01";
				  	}
					
					// selecteer de juiste lijst termen
					if (lijst == "VNG lijst 1") {
						var queries = lijst1
					} else if (lijst == "VNG lijst 2") {
						var queries = lijst2
					} else {
						var queries = lijst3
					}
					
					// Send query one by one
					for (var i = 0; i < queries.length; i++) {
						getQueryResults(gemeente, queries[i], i, start_date, end_date, queries);
					}   
				}

				function getQueryResults(gemeente, query, valueIndex,start_date, end_date, queries){
				  	// Transfer sting so it can be used in asking the query to the API
				  	if (gemeente == "combined_index"){
				  		gemeente = "";
				  	} else{
				  		gemeente += "/"
				  	}

				  	$.post('https://api.openraadsinformatie.nl/v0/'+gemeente+'search', 
				  		'{"query":"\\"'+query+'\\"","filters":{"collection":{"terms":["aalsmeer","alkmaar","almelo","almere","amersfoort","amstelveen","amsterdam","arnhem","baarn","barneveld","beemster","binnenmaas","bodegravenreeuwijk","borne","boxmeer","buren","cappelleadijssel","castricum", "culemborg","den_helder","denhaag","deventer","dewolden","diemen","doetinchem","dongen","drimmelen","edamvolendam","ede","emmen","enschede","epe","ettenleur","goirle","gouda","groningen","hardenberg","heemskerk","heerde","hendrikidoambacht","hilvarenbeek","hilversum","hollandskroon","hulst","katwijk","krimpenadijssel","krimpenerwaard","landsmeer","leeuwarden","leiden","leiderdorp","leusden","lingewaard","loonopzand","losser","maassluis","maastricht","medemblik","meierijstad","meppel","moerdijk","molenwaard","nieuwegein","nieuwkoop","nijkerk","noordoostpolder","noordwijk","noordwijkerhout","oisterwijk","oldambt","ommen","oosterhout","oostgelre","oss","oude_ijsselstreek","overbetuwe","raalte","rheden","rhenen","rijswijk","roermond","roosendaal","rucphen","schagen","schiedam","soest","staphorst","steenbergen","steenwijkerland","stichtsevecht","texel","teylingen","utrecht","veenendaal","velsen","vlaardingen","vlissingen","voorschoten","voorst","waalwijk","wageningen","wassenaar","zaanstad","zandvoort","zeist","zoetermeer","zwartewaterland","zwolle"]}, "start_date":{"from": "'+start_date+'","to":"'+end_date+'"}}}')
				  	.done(function(data){
					    ValuesBar[valueIndex] = {country: query,value:data.meta.total, key:valueIndex}; // Load important data, "data.meta.total" is the count of the query.
					    var data = ValuesBar
					    counterBar ++;
					    if(counterBar == queries.length){ // if all queries are executed and thus data is in, go on with making charts
					    	if ($("#gemeente").val() == "combined_index") {
					    		var x = "alle gemeenten"
					    	} else{
					    		var x = $("#gemeente").val()
					    	}
					    	document.getElementById("totalCount").innerHTML = "Je bekijkt nu de resultaten van "+x+". Klik op  het onderwerp om te zien in welke gemeenteraden het onderwerp is besproken."
					      	init(data,start_date, end_date)
		      			}  
					})
				}

				var data = [],
				  svg,
				  defs,
				  main_xScale,
				  main_yScale,
				  main_xAxis,
				  main_yAxis;

				var zoomer = d3.behavior.zoom()
				    .on("zoom", null);

				var main_margin = {top: 10, right: 10, bottom: 30, left: 250},
				    main_width = 560 - main_margin.left - main_margin.right,
				    main_height = 550 - main_margin.top - main_margin.bottom;

				svg = d3.select("#chart").append("svg")
				    .attr("class", "svgWrapper")
				    .attr("width", main_width + main_margin.left + main_margin.right)
				    .attr("height", main_height + main_margin.top + main_margin.bottom);

				var sort_btn_value = d3.select("#Aantal")
				    .attr("state", 0);

				var sort_btn_name = d3.select("#Alfabetisch")
				    .attr("state", 0); 

				var mainGroup = svg.append("g")
			        .attr("class","mainGroupWrapper")
			        .attr("transform","translate(" + main_margin.left + "," + main_margin.top + ")")
			        .append("g") //another one for the clip path - due to not wanting to clip the labels
			        .attr("clip-path", "url(#clip)")
			        .style("clip-path", "url(#clip)")
			        .attr("class","mainGroup")


				/////////////////////////////////////////////////////////////
				////////////////////// Initiate scales //////////////////////
				/////////////////////////////////////////////////////////////

				main_xScale = d3.scale.linear().range([0, main_width]);

				main_yScale = d3.scale.ordinal().rangeBands([0, main_height], 0.4, 0);

				//Create x axis object
				main_xAxis = d3.svg.axis()
				  .scale(main_xScale)
				  .orient("bottom")
				  .ticks(4)
				  .outerTickSize(0);

				//Add group for the x axis
				d3.select(".mainGroupWrapper").append("g")
				    .attr("class", "x axis")
				    .attr("transform", "translate(" + 0 + "," + (main_height + 5) + ")");

				//Create y axis object
				main_yAxis = d3.svg.axis()
				  .scale(main_yScale)
				  .orient("left")
				  .tickSize(0)
				  .outerTickSize(0);

				//Add group for the y axis
				mainGroup.append("g")
				    .attr("class", "y axis")
				    .attr("transform", "translate(-5,0)");

				var linearColorScale = d3.scale.linear()
	          		.domain([0, lijstGemeenten.length])
	          		.range(["#00ACEC","#003767"]);

				function init(data,start_date, end_date) {

					data.sort(function(a,b) { return b.value - a.value; });

					init2(data,1,start_date, end_date)

					sort_btn_value.attr("state", 0); // set the state to default

					sort_btn_name.attr("state", 0); // set the state to default

					sort_btn_value.on("click", function () { // sort data on value
				        var self = d3.select(this);
				        var state = +self.attr("state");
				        var ascending = function (a, b) {
				          return a.value - b.value
				        }
				        var descending = function (a, b) {
				          return b.value - a.value
				        }
				        if (state === 0) {
				          data.sort(ascending);
				          state = 1;
				        } else if (state === 1) {
				          data.sort(descending);
				          state = 0;
				        }
				        self.attr("state", state);
				        init2(data,0,start_date, end_date) // if clicked, redraw the chart
				     })

					sort_btn_name.on("click", function () { // sort data on name
				        var self = d3.select(this);
				        var state = +self.attr("state");
				        var az = function(a, b){
						    if(a.country < b.country) { return -1; }
						    if(a.country > b.country) { return 1; }
						    return 0;
						}
				        var za = function(a, b){
						    if(a.country < b.country) { return 1; }
						    if(a.country > b.country) { return -1; }
						    return 0;
						}
				        if (state === 0) {
				          data.sort(az);
				          state = 1;
				        } else if (state === 1) {
				          data.sort(za);
				          state = 0;
				        }
				        self.attr("state", state);
				        init2(data,0,start_date, end_date) // if clicked, redraw the chart
				     })
				}
				
				function init2(data, newdata,start_date, end_date){
					/////////////////////////////////////////////////////////////
					/////////////////////// Update scales ///////////////////////
					/////////////////////////////////////////////////////////////
					//Update the scales
					main_xScale.domain([0, 1.3*d3.max(data, function(d) { return d.value; })]);
					main_yScale.domain(data.map(function(d) { return d.country; }));

					//Create the visual part of the y axis
					d3.select(".mainGroup").select(".y.axis").call(main_yAxis);
					d3.select(".mainGroupWrapper").select(".x.axis").call(main_xAxis);

					svg.selectAll(".y.axis .tick")
						.on("click", function(d) { // if you click on the name of bar, query that term
							document.getElementById("VrijeZoeker").disabled = true; // once again needed to prevent multiple queries at once
							document.getElementById("OnderwerpenZoeker").disabled = true; // once again needed to prevent multiple queries at once
							barChartPerGemeente(d, $("#start_date").val(), $("#end_date").val(), $("#gemeente").val())})
						;

					//DATA JOIN
					var bar = d3.select(".mainGroup").selectAll(".bar")
					    .data(data, function(d) {return d.key; });

					//UPDATE
					bar
					  .attr("x", 0)
					  .attr("width", function(d) { return main_xScale(d.value); })
					  .attr("y", function(d,i) { return main_yScale(d.country); })
					  .attr("height", main_yScale.rangeBand());


					if (newdata) { // Color data in right scale if reshuffled
						bar.style("fill", function (d,i) {
			                return linearColorScale(i);
			            })
					}

					//ENTER
					bar.enter().append("rect")
						.attr("class", "bar")
						.style("fill", function (d,i) {
						    return linearColorScale(i);
						})
						.attr("x", 0)
						.attr("width", function(d) { return main_xScale(d.value); })
						.attr("y", function(d,i) { return main_yScale(d.country); })
						.attr("height", main_yScale.rangeBand())
						.on("mousemove", function(d) {	// light up yellow if you go over it
							d3.select(this).style("fill", "yellow")	
						})					
					    .on("mouseout", function(d,i) { // become normal color again
					        d3.select(this).style("fill", linearColorScale(i));
					    })
						.on('click', function(d) { // if you click on the bar, query that term
							document.getElementById("VrijeZoeker").disabled = true; // once again needed to prevent multiple queries at once
							document.getElementById("OnderwerpenZoeker").disabled = true; // once again needed to prevent multiple queries at once
							barChartPerGemeente(d.country, $("#start_date").val(), $("#end_date").val(), $("#gemeente").val())
						});;

					d3.select(".mainGroup").selectAll(".bar-label").remove()

					// create the labels with the amounts on the bars
					d3.select(".mainGroup").selectAll(".bar-label")
			            .data(data)
			            .enter()
			            .append("text")
			            .classed("bar-label", true);  	

					// create the labels with the amounts on the bars
			        d3.select(".mainGroup").selectAll(".bar-label")
			            .attr("x", function (d, i) {
			              return main_xScale(d.value) + main_yScale.rangeBand()
			            })
			            .attr("y", function (d, i) {
			              return main_yScale(d.country)
			            })
			            .attr("dy", 15)
			            .text(function (d, i) {
			              return d.value
			            })
			            .style("fill", "black")
			            .style("text-anchor", "middle")
			            .on('click', function(d) {  // if you click on the value, query that term
			            	document.getElementById("VrijeZoeker").disabled = true; // once again needed to prevent multiple queries at once
							document.getElementById("OnderwerpenZoeker").disabled = true; // once again needed to prevent multiple queries at once
							barChartPerGemeente(d.country, $("#start_date").val(), $("#end_date").val(), $("#gemeente").val())
						});

					//EXIT
					bar.exit()
					  .remove();

					document.getElementById("loader").style.display = "none"; // Loader can once again be reset.
					document.getElementById("VrijeZoeker").disabled = false; // Make searching possible again!
					document.getElementById("OnderwerpenZoeker").disabled = false; // Make searching possible again!
				}//update
			}

			function barChartPerGemeente(query, start_date, end_date, gemeente){
				d3.select(".svgWrapper").remove() // remove last chart
				console.log(gemeente)
				if (gemeente == "combined_index") {
					var lijstGemeenten = Array("aalsmeer","alkmaar","almelo","almere","amersfoort","amstelveen","amsterdam","arnhem","baarn","barneveld","beemster","binnenmaas","bodegravenreeuwijk","borne","boxmeer","buren","cappelleadijssel","castricum", "culemborg","den_helder","denhaag","deventer","dewolden","diemen","doetinchem","dongen","drimmelen","edamvolendam","ede","emmen","enschede","epe","ettenleur","goirle","gouda","groningen","hardenberg","heemskerk","heerde","hendrikidoambacht","hilvarenbeek","hilversum","hollandskroon","hulst","katwijk","krimpenadijssel","krimpenerwaard","landsmeer","leeuwarden","leiden","leiderdorp","leusden","lingewaard","loonopzand","losser","maassluis","maastricht","medemblik","meierijstad","meppel","moerdijk","molenwaard","nieuwegein","nieuwkoop","nijkerk","noordoostpolder","noordwijk","noordwijkerhout","oisterwijk","oldambt","ommen","oosterhout","oostgelre","oss","oude_ijsselstreek","overbetuwe","raalte","rheden","rhenen","rijswijk","roermond","roosendaal","rucphen","schagen","schiedam","soest","staphorst","steenbergen","steenwijkerland","stichtsevecht","texel","teylingen","utrecht","veenendaal","velsen","vlaardingen","vlissingen","voorschoten","voorst","waalwijk","wageningen","wassenaar","zaanstad","zandvoort","zeist","zoetermeer","zwartewaterland","zwolle")
				}
				else {
					var lijstGemeenten = Array(gemeente)
				}
				
				getAmountBar(query, start_date, end_date)
				
				function getAmountBar(query, start_date, end_date) {
					document.getElementById("loader").style.display = "block"; // Show loader, as you are loading a new chart
					counterBar = 0;
					ValuesBar = Array();

					// If people don't fill in a date, choose it ourselves. 
					if (start_date == ""){
				  		start_date = "1980-01-01";
				  	}
				  	if (end_date == ""){
				  		end_date = "2030-01-01";
				  	}
					
					// One by one, query all the municipalities.	
					for (var i = 0; i < lijstGemeenten.length; i++) {
						getQueryResults(query, lijstGemeenten[i], i, start_date, end_date);
					}
				}

				function getQueryResults(query, gemeente, valueIndex,start_date, end_date){
				  	// Make it possible to query the right information
				  	if (gemeente == "combined_index"){
				  		gemeente = "";
				  	} else{
				  		gemeente += "/"
				  	}
				  	
				  	sumAll=0 // needed to count everything
				  	$.post('https://api.openraadsinformatie.nl/v0/'+gemeente+'search', 
				  		'{"query":"\\"'+query+'\\"","filters":{"collection":{"terms":["aalsmeer","alkmaar","almelo","almere","amersfoort","amstelveen","amsterdam","arnhem","baarn","barneveld","beemster","binnenmaas","bodegravenreeuwijk","borne","boxmeer","buren","cappelleadijssel","castricum", "culemborg","den_helder","denhaag","deventer","dewolden","diemen","doetinchem","dongen","drimmelen","edamvolendam","ede","emmen","enschede","epe","ettenleur","goirle","gouda","groningen","hardenberg","heemskerk","heerde","hendrikidoambacht","hilvarenbeek","hilversum","hollandskroon","hulst","katwijk","krimpenadijssel","krimpenerwaard","landsmeer","leeuwarden","leiden","leiderdorp","leusden","lingewaard","loonopzand","losser","maassluis","maastricht","medemblik","meierijstad","meppel","moerdijk","molenwaard","nieuwegein","nieuwkoop","nijkerk","noordoostpolder","noordwijk","noordwijkerhout","oisterwijk","oldambt","ommen","oosterhout","oostgelre","oss","oude_ijsselstreek","overbetuwe","raalte","rheden","rhenen","rijswijk","roermond","roosendaal","rucphen","schagen","schiedam","soest","staphorst","steenbergen","steenwijkerland","stichtsevecht","texel","teylingen","utrecht","veenendaal","velsen","vlaardingen","vlissingen","voorschoten","voorst","waalwijk","wageningen","wassenaar","zaanstad","zandvoort","zeist","zoetermeer","zwartewaterland","zwolle"]}, "start_date":{"from": "'+start_date+'","to":"'+end_date+'"}}}')
				  	.done(function(data){
					    if(gemeente == ""){
					    	gemeente = "Alle gemeenten"
					    } else { // Capitalize the municipalities
					    	gemeente = gemeente.charAt(0).toUpperCase() + gemeente.slice(1,-1);
					    }
					    ValuesBar[valueIndex] = {country: gemeente,value:data.meta.total, key:valueIndex};
					    sumAll += data.meta.total // Keep adding the values of an individual municipality to the grand total
					    data = ValuesBar

					    counterBar ++;
					    if(counterBar == lijstGemeenten.length){
					    	if ($("#gemeente").val() == "combined_index") {
					    		var x = "alle gemeenten"
					    	} else{
					    		var x = gemeente
					    	}
					    	document.getElementById("totalCount").innerHTML = "In totaal komt de term \""+query+"\" in <b>"+sumAll+" documenten</b> in "+x+" voor tussen "+start_date+" en "+end_date+". Klik op een van de balken om de documenten te bekijken." // update the count of combined number. (for some reason this count is not the same as the output of the combined index.)
					    	$.post('https://api.openraadsinformatie.nl/v0/search', 
						  		'{"query":"\\"'+query+'\\"","filters":{"collection":{"terms":["aalsmeer","alkmaar","almelo","almere","amersfoort","amstelveen","amsterdam","arnhem","baarn","barneveld","beemster","binnenmaas","bodegravenreeuwijk","borne","boxmeer","buren","cappelleadijssel","castricum", "culemborg","den_helder","denhaag","deventer","dewolden","diemen","doetinchem","dongen","drimmelen","edamvolendam","ede","emmen","enschede","epe","ettenleur","goirle","gouda","groningen","hardenberg","heemskerk","heerde","hendrikidoambacht","hilvarenbeek","hilversum","hollandskroon","hulst","katwijk","krimpenadijssel","krimpenerwaard","landsmeer","leeuwarden","leiden","leiderdorp","leusden","lingewaard","loonopzand","losser","maassluis","maastricht","medemblik","meierijstad","meppel","moerdijk","molenwaard","nieuwegein","nieuwkoop","nijkerk","noordoostpolder","noordwijk","noordwijkerhout","oisterwijk","oldambt","ommen","oosterhout","oostgelre","oss","oude_ijsselstreek","overbetuwe","raalte","rheden","rhenen","rijswijk","roermond","roosendaal","rucphen","schagen","schiedam","soest","staphorst","steenbergen","steenwijkerland","stichtsevecht","texel","teylingen","utrecht","veenendaal","velsen","vlaardingen","vlissingen","voorschoten","voorst","waalwijk","wageningen","wassenaar","zaanstad","zandvoort","zeist","zoetermeer","zwartewaterland","zwolle"]}, "start_date":{"from": "'+start_date+'","to":"'+end_date+'"}}}').done(function(totalCount){console.log(totalCount)})
					      	init(data,query)
		      			}				    
					})
				}

				var data = [],
				  svg,
				  defs,
				  gBrush,
				  brush,
				  main_xScale,
				  mini_xScale,
				  main_yScale,
				  mini_yScale,
				  main_yZoom,
				  main_xAxis,
				  main_yAxis,
				  mini_width,
				  textScale;

				var zoomer = d3.behavior.zoom()
				    .on("zoom", null);

				var main_margin = {top: 10, right: 10, bottom: 30, left: 180},
				    main_width = 460 - main_margin.left - main_margin.right,
				    main_height = 500 - main_margin.top - main_margin.bottom;

				var mini_margin = {top: 10, right: 10, bottom: 30, left: 10},
				    mini_height = 500 - mini_margin.top - mini_margin.bottom;
					mini_width = 100 - mini_margin.left - mini_margin.right;

				svg = d3.select("#chart").append("svg")
				    .attr("class", "svgWrapper")
				    .attr("width", main_width + main_margin.left + main_margin.right + mini_width + mini_margin.left + mini_margin.right)
				    .attr("height", main_height + main_margin.top + main_margin.bottom)
				    .call(zoomer)
				    .on("wheel.zoom", scroll)
				    .on("mousedown.zoom", null)
				    .on("touchstart.zoom", null)
				    .on("touchmove.zoom", null)
				    .on("touchend.zoom", null);


		        var sort_btn_value = d3.select("#Aantal")
				    .attr("state", 0);

				var sort_btn_name = d3.select("#Alfabetisch")
				    .attr("state", 0); 

				var mainGroup = svg.append("g")
			        .attr("class","mainGroupWrapper")
			        .attr("transform","translate(" + main_margin.left + "," + main_margin.top + ")")
			        .append("g") //another one for the clip path - due to not wanting to clip the labels
			        .attr("clip-path", "url(#clip)")
			        .style("clip-path", "url(#clip)")
			        .attr("class","mainGroup")

				var miniGroup = svg.append("g")
				        .attr("class","miniGroup")
				        .attr("transform","translate(" + (main_margin.left + main_width + main_margin.right + mini_margin.left) + "," + mini_margin.top + ")");

				var brushGroup = svg.append("g")
				        .attr("class","brushGroup")
				        .attr("transform","translate(" + (main_margin.left + main_width + main_margin.right + mini_margin.left) + "," + mini_margin.top + ")");

				/////////////////////////////////////////////////////////////
				////////////////////// Initiate scales //////////////////////
				/////////////////////////////////////////////////////////////

				main_xScale = d3.scale.linear().range([0, main_width]);
				mini_xScale = d3.scale.linear().range([0, mini_width]);

				main_yScale = d3.scale.ordinal().rangeBands([0, main_height], 0.4, 0);
				mini_yScale = d3.scale.ordinal().rangeBands([0, mini_height], 0.4, 0);

				//Based on the idea from: https://stackoverflow.com/questions/21485339/d3-brushing-on-grouped-bar-chart
				main_yZoom = d3.scale.linear()
				    .range([0, main_height])
				    .domain([0, main_height]);

				//Create x axis object
				main_xAxis = d3.svg.axis()
				  .scale(main_xScale)
				  .orient("bottom")
				  .ticks(4)
				  .outerTickSize(0);

				//Add group for the x axis
				d3.select(".mainGroupWrapper").append("g")
				    .attr("class", "x axis")
				    .attr("transform", "translate(" + 0 + "," + (main_height + 5) + ")");

				//Create y axis object
				main_yAxis = d3.svg.axis()
				  .scale(main_yScale)
				  .orient("left");

				//Add group for the y axis
				mainGroup.append("g")
				    .attr("class", "y axis")
				    .attr("transform", "translate(-5,0)");

				var linearColorScale = d3.scale.linear()
					          		.domain([0, lijstGemeenten.length])
					          		.range(["#00ACEC","#003767"]);


				function init(data,query) {

					data.sort(function(a,b) { return b.value - a.value; });
					
					init2(data,1,query)

					sort_btn_value.attr("state", 0); // set sorting to default 

					sort_btn_name.attr("state", 0); // set sorting to default 

					sort_btn_value.on("click", function () { // Sort on values
				        var self = d3.select(this);
				        var state = +self.attr("state");
				        var ascending = function (a, b) {
				          return a.value - b.value
				        }
				        var descending = function (a, b) {
				          return b.value - a.value
				        }
				        if (state === 0) {
				          data.sort(ascending);
				          state = 1;
				        } else if (state === 1) {
				          data.sort(descending);
				          state = 0;
				        }
				        self.attr("state", state);
				        init2(data,0,query) // Query with new sorting
				     })

					sort_btn_name.on("click", function () { // Sort on alphabet
				        var self = d3.select(this);
				        var state = +self.attr("state");
				        var az = function(a, b){
						    if(a.country < b.country) { return -1; }
						    if(a.country > b.country) { return 1; }
						    return 0;
						}
				        var za = function(a, b){
						    if(a.country < b.country) { return 1; }
						    if(a.country > b.country) { return -1; }
						    return 0;
						}
				        if (state === 0) {
				          data.sort(az);
				          state = 1;
				        } else if (state === 1) {
				          data.sort(za);
				          state = 0;
				        }
				        self.attr("state", state);
				        init2(data,0,query) // Query with new sorting
				     })
				}
				
				function init2(data, newdata,query){
				/////////////////////////////////////////////////////////////
				/////////////////////// Update scales ///////////////////////
				/////////////////////////////////////////////////////////////
				//Update the scales
				main_xScale.domain([0, 1.3*d3.max(data, function(d) { return d.value; })]);
				mini_xScale.domain([0, d3.max(data, function(d) { return d.value; })]);
				main_yScale.domain(data.map(function(d) { return d.country; }));
				mini_yScale.domain(data.map(function(d) { return d.country; }));

				//Create the visual part of the y axis
				d3.select(".mainGroup").select(".y.axis").call(main_yAxis);
				d3.select(".mainGroupWrapper").select(".x.axis").call(main_xAxis);

				svg.selectAll(".y.axis .tick")
						.on("click", function(d) { // Create the URL to query right information at zoek.openraadsinformatie.nl
					    	var options = {filters:{collection:{terms:["aalsmeer","alkmaar","almelo","almere","amersfoort","amstelveen","amsterdam","arnhem","baarn","barneveld","beemster","binnenmaas","bodegravenreeuwijk","borne","boxmeer","buren","cappelleadijssel","castricum", "culemborg","den_helder","denhaag","deventer","dewolden","diemen","doetinchem","dongen","drimmelen","edamvolendam","ede","emmen","enschede","epe","ettenleur","goirle","gouda","groningen","hardenberg","heemskerk","heerde","hendrikidoambacht","hilvarenbeek","hilversum","hollandskroon","hulst","katwijk","krimpenadijssel","krimpenerwaard","landsmeer","leeuwarden","leiden","leiderdorp","leusden","lingewaard","loonopzand","losser","maassluis","maastricht","medemblik","meierijstad","meppel","moerdijk","molenwaard","nieuwegein","nieuwkoop","nijkerk","noordoostpolder","noordwijk","noordwijkerhout","oisterwijk","oldambt","ommen","oosterhout","oostgelre","oss","oude_ijsselstreek","overbetuwe","raalte","rheden","rhenen","rijswijk","roermond","roosendaal","rucphen","schagen","schiedam","soest","staphorst","steenbergen","steenwijkerland","stichtsevecht","texel","teylingen","utrecht","veenendaal","velsen","vlaardingen","vlissingen","voorschoten","voorst","waalwijk","wageningen","wassenaar","zaanstad","zandvoort","zeist","zoetermeer","zwartewaterland","zwolle"]},types:{terms:["events","motions","vote_events"]},classification:{terms:["Agendapunt","Agenda","Ingekomen stukken","Toezeggingen","Moties","Schriftelijke vragen","Raadsbrieven","Verslag","Commissiebrieven S&R", "Toezeggingen S&R","Amendementen","Besluitenlijst B&W","Toezeggingen M&S","Commissiebrieven M&S","Raadsvragen","Schriftelijke vragen (export)","Gemeentebladen","Schriftelijke Vragen","Toezeggingen Raad","Uitnodigingen","RSS","Voortganglijst/toezeggingen" ,"Brieven aan de raad","Informatie","Informatieve Stukken College","Stemmingen","Persberichten","Raadsverslagen","Artikel 44 vragen","Informatie van het college","Verslagen S&R","Collegebrieven","Aangeleverde raadsvoorstellen","Aanbevelingen onderzoeken","Brieven B&W aan raad","Besluitenlijsten raad","Griffie-info documenten","Besluitenlijsten college van B&W","Technische vragen","Besluitenlijst Raad","Rapport","Raadsmededelingen & Memo's","Memo's","Informatienota's","Memo actieve raadsinformatie","Overige raadsinformatie","B&W besluiten","Vragen aan het college","Weekmail","Standpuntenlijsten commissie(s)","Artikel 45 vragen","Artikel 32 vragen","Vragen","Besluitenlijsten (B&W)","Genomen raadsbesluiten","Raadsvragen en antwoorden","College besluitenlijsten","Beantwoorde raadsvragen","Report","Besluitenlijsten college","Verslagen M&S","Dossiers","Notulen raad","Besluitenlijsten van de raad","Vastgesteld beleid","Rekenkamerrapporten","Schriftelijke vragen (artikel 41 RvO)","Besluitenlijsten","Verslag B&W","Vergaderstukken gemeenschappelijke regelingen", "Collegevoorstellen (ter informatie)","Raadsvragen Schriftelijke","Verslagen Raad","export","Brieven aan de raad  Openbaar","Besluitenlijst","Collegeberichten","agendapunt_actielijst","Besluitenlijst raad","Raadsbesluiten","Besluitenlijst PS","Politieke vragen","Videotulen Commissie Stad en Ruimte","Openbare besluitenlijsten college","Notulen","Raadsinformatie","Videotulen Raadsvergadering ","Schriftelijke vragen art. 18","Besluitenlijsten B&W","Verslagen Vragenuur","Griffie-info","Schriftelijke vragen art. 41","Sjabloonvragen","Verslag Raad","Videotulen Commissie Mens en Samenleving","Raadsjournaal","Besluitenlijsten Raad","Mondelinge Vragen","Videotulen Gemeenteraad","Resolution"]},start_date:{from:start_date,to:end_date}}, facets:{start_date:{interval:"year"}},sort:"start_date",order:"desc"}
						    options = window.LZString.compressToBase64(JSON.stringify(options)).split('/').join('-')

						    window.open(
						    	'http://zoek.openraadsinformatie.nl/#/g/'+d.toLowerCase()+'/search/' +query+'/options/'+options,
						    	'_blank' // <- This is what makes it open in a new window.
					    	);
						})
						;

				/////////////////////////////////////////////////////////////
				///////////////////// Label axis scales /////////////////////
				/////////////////////////////////////////////////////////////

				textScale = d3.scale.linear()
				  .domain([15,50])
				  .range([12,6])
				  .clamp(true);

				/////////////////////////////////////////////////////////////
				///////////////////////// Create brush //////////////////////
				/////////////////////////////////////////////////////////////

				//What should the first extent of the brush become - a bit arbitrary this
				
				if (lijstGemeenten.length < 15){
					console.log("no brushing")
					update(data, newdata, query)
					// brush = d3.svg.brush()
					//     .y(mini_yScale)
					//     .extent([mini_yScale(data[0].country), mini_yScale(data[brushExtent].country)])
					//     .on("brush", function(d){brushmove(data, newdata,query)})
				}
				else{
					var brushExtent = 15;
					brush = d3.svg.brush()
					    .y(mini_yScale)
					    .extent([mini_yScale(data[0].country), mini_yScale(data[brushExtent].country)])
					    .on("brush", function(d){brushmove(data, newdata,query)})
				

				
					console.log(data[0])
					
					    //.on("brushend", brushend);

					d3.select(".brushGroup").selectAll("*").remove()

					//Set up the visual part of the brush
					gBrush = d3.select(".brushGroup").append("g")
						.attr("class", "brush")
						.call(brush);

					gBrush.selectAll(".resize")
						.append("line")
						.attr("x2", mini_width);

					gBrush.selectAll(".resize")
						.append("path")
						.attr("d", d3.svg.symbol().type("triangle-up").size(20))
						.attr("transform", function(d,i) { 
						return i ? "translate(" + (mini_width/2) + "," + 4 + ") rotate(180)" : "translate(" + (mini_width/2) + "," + -4 + ") rotate(0)"; 
						});

					gBrush.selectAll("rect")
						.attr("width", mini_width);

					//On a click recenter the brush window
					gBrush.select(".background")
						.on("mousedown.brush", brushcenter)
						.on("touchstart.brush", brushcenter);

					///////////////////////////////////////////////////////////////////////////
					/////////////////// Create a rainbow gradient - for fun ///////////////////
					///////////////////////////////////////////////////////////////////////////

					defs = svg.append("defs")

					//Create two separate gradients for the main and mini bar - just because it looks fun
					// createGradient("gradient-rainbow-main", "60%");
					// createGradient("gradient-rainbow-mini", "13%");

					//Add the clip path for the main bar chart
					defs.append("clipPath")
						.attr("id", "clip")
						.append("rect")
						.attr("x", -main_margin.left)
						.attr("width", main_width + main_margin.left)
						.attr("height", main_height);

					/////////////////////////////////////////////////////////////
					/////////////// Set-up the mini bar chart ///////////////////
					/////////////////////////////////////////////////////////////

					//The mini brushable bar
					//DATA JOIN
					var mini_bar = d3.select(".miniGroup").selectAll(".bar")
						.data(data, function(d) { return d.key; });

					//UDPATE
					mini_bar
						.attr("width", function(d) { return mini_xScale(d.value); })
						.attr("y", function(d,i) { return mini_yScale(d.country); })
						.attr("height", mini_yScale.rangeBand());

					if (newdata) { //fill with the right color, based on value
						mini_bar.style("fill", function (d,i) {
			                return linearColorScale(i);
			            })
					}

					//ENTER
					mini_bar.enter().append("rect")
						.attr("class", "bar")
						.attr("x", 0)
						.attr("width", function(d) { return mini_xScale(d.value); })
						.attr("y", function(d,i) { return mini_yScale(d.country); })
						.attr("height", mini_yScale.rangeBand())
						.style("fill", function (d,i) {
						    return linearColorScale(i);
						});

					//EXIT
					mini_bar.exit()
						.remove();

					//Start the brush
					gBrush.call(brush.event);
				}

				}//init

				//Function runs on a brush move - to update the big bar chart
				function update(data, newdata,query) {
					/////////////////////////////////////////////////////////////
					////////// Update the bars of the main bar chart ////////////
					/////////////////////////////////////////////////////////////

					//DATA JOIN
					var bar = d3.select(".mainGroup").selectAll(".bar")
					    .data(data, function(d) {return d.key; });

					if (data.length == 1) {
						bar
						  .attr("x", 0)
						  .attr("width", function(d) { return main_xScale(d.value); })
						  .attr("y", 221)
						  .attr("height", 18.4);
					}else{
						//UPDATE
						bar
						  .attr("x", 0)
						  .attr("width", function(d) { return main_xScale(d.value); })
						  .attr("y", function(d,i) { return main_yScale(d.country); })
						  .attr("height", main_yScale.rangeBand());

					}	
					

					if (newdata) { //fill with the right color, based on value
						bar.style("fill", function (d,i) {
			                return linearColorScale(i);
			            })
					}

					//ENTER
					if (data.length == 1) {
						bar.enter().append("rect")
							.attr("class", "bar")
							.style("fill", function (d,i) {
								return linearColorScale(i);
							})
							.attr("x", 0)
							.attr("width", function(d) { return main_xScale(d.value); })
							.attr("y", 221)
							.attr("height", 18.4)
							.on("mousemove", function(d) {		
								d3.select(this).style("fill", "yellow")	
							})					
						    .on("mouseout", function(d,i) {		
						        d3.select(this).style("fill", linearColorScale(i));
						    })
						    .on('click', function(d) {
						    	var options = {filters:{collection:{terms:["aalsmeer","alkmaar","almelo","almere","amersfoort","amstelveen","amsterdam","arnhem","baarn","barneveld","beemster","binnenmaas","bodegravenreeuwijk","borne","boxmeer","buren","cappelleadijssel","castricum", "culemborg","den_helder","denhaag","deventer","dewolden","diemen","doetinchem","dongen","drimmelen","edamvolendam","ede","emmen","enschede","epe","ettenleur","goirle","gouda","groningen","hardenberg","heemskerk","heerde","hendrikidoambacht","hilvarenbeek","hilversum","hollandskroon","hulst","katwijk","krimpenadijssel","krimpenerwaard","landsmeer","leeuwarden","leiden","leiderdorp","leusden","lingewaard","loonopzand","losser","maassluis","maastricht","medemblik","meierijstad","meppel","moerdijk","molenwaard","nieuwegein","nieuwkoop","nijkerk","noordoostpolder","noordwijk","noordwijkerhout","oisterwijk","oldambt","ommen","oosterhout","oostgelre","oss","oude_ijsselstreek","overbetuwe","raalte","rheden","rhenen","rijswijk","roermond","roosendaal","rucphen","schagen","schiedam","soest","staphorst","steenbergen","steenwijkerland","stichtsevecht","texel","teylingen","utrecht","veenendaal","velsen","vlaardingen","vlissingen","voorschoten","voorst","waalwijk","wageningen","wassenaar","zaanstad","zandvoort","zeist","zoetermeer","zwartewaterland","zwolle"]},types:{terms:["events","motions","vote_events"]},classification:{terms:["Agendapunt","Agenda","Ingekomen stukken","Toezeggingen","Moties","Schriftelijke vragen","Raadsbrieven","Verslag","Commissiebrieven S&R", "Toezeggingen S&R","Amendementen","Besluitenlijst B&W","Toezeggingen M&S","Commissiebrieven M&S","Raadsvragen","Schriftelijke vragen (export)","Gemeentebladen","Schriftelijke Vragen","Toezeggingen Raad","Uitnodigingen","RSS","Voortganglijst/toezeggingen" ,"Brieven aan de raad","Informatie","Informatieve Stukken College","Stemmingen","Persberichten","Raadsverslagen","Artikel 44 vragen","Informatie van het college","Verslagen S&R","Collegebrieven","Aangeleverde raadsvoorstellen","Aanbevelingen onderzoeken","Brieven B&W aan raad","Besluitenlijsten raad","Griffie-info documenten","Besluitenlijsten college van B&W","Technische vragen","Besluitenlijst Raad","Rapport","Raadsmededelingen & Memo's","Memo's","Informatienota's","Memo actieve raadsinformatie","Overige raadsinformatie","B&W besluiten","Vragen aan het college","Weekmail","Standpuntenlijsten commissie(s)","Artikel 45 vragen","Artikel 32 vragen","Vragen","Besluitenlijsten (B&W)","Genomen raadsbesluiten","Raadsvragen en antwoorden","College besluitenlijsten","Beantwoorde raadsvragen","Report","Besluitenlijsten college","Verslagen M&S","Dossiers","Notulen raad","Besluitenlijsten van de raad","Vastgesteld beleid","Rekenkamerrapporten","Schriftelijke vragen (artikel 41 RvO)","Besluitenlijsten","Verslag B&W","Vergaderstukken gemeenschappelijke regelingen", "Collegevoorstellen (ter informatie)","Raadsvragen Schriftelijke","Verslagen Raad","export","Brieven aan de raad  Openbaar","Besluitenlijst","Collegeberichten","agendapunt_actielijst","Besluitenlijst raad","Raadsbesluiten","Besluitenlijst PS","Politieke vragen","Videotulen Commissie Stad en Ruimte","Openbare besluitenlijsten college","Notulen","Raadsinformatie","Videotulen Raadsvergadering ","Schriftelijke vragen art. 18","Besluitenlijsten B&W","Verslagen Vragenuur","Griffie-info","Schriftelijke vragen art. 41","Sjabloonvragen","Verslag Raad","Videotulen Commissie Mens en Samenleving","Raadsjournaal","Besluitenlijsten Raad","Mondelinge Vragen","Videotulen Gemeenteraad","Resolution"]},start_date:{from:start_date,to:end_date}}, facets:{start_date:{interval:"year"}},sort:"start_date",order:"desc"}
							    options = window.LZString.compressToBase64(JSON.stringify(options)).split('/').join('-')

							    window.open(
							    	'http://zoek.openraadsinformatie.nl/#/g/'+d.country.toLowerCase()+'/search/' +query+'/options/'+options,
							    	'_blank' // <- This is what makes it open in a new window.
						    	);
							   
							});;
					}
					else{


						bar.enter().append("rect")
							.attr("class", "bar")
							.style("fill", function (d,i) {
								return linearColorScale(i);
							})
							.attr("x", 0)
							.attr("width", function(d) { return main_xScale(d.value); })
							.attr("y", function(d,i) { return main_yScale(d.country); })
							.attr("height", main_yScale.rangeBand())
							.on("mousemove", function(d) {		
								d3.select(this).style("fill", "yellow")	
							})					
						    .on("mouseout", function(d,i) {		
						        d3.select(this).style("fill", linearColorScale(i));
						    })
						    .on('click', function(d) {
						    	var options = {filters:{collection:{terms:["aalsmeer","alkmaar","almelo","almere","amersfoort","amstelveen","amsterdam","arnhem","baarn","barneveld","beemster","binnenmaas","bodegravenreeuwijk","borne","boxmeer","buren","cappelleadijssel","castricum", "culemborg","den_helder","denhaag","deventer","dewolden","diemen","doetinchem","dongen","drimmelen","edamvolendam","ede","emmen","enschede","epe","ettenleur","goirle","gouda","groningen","hardenberg","heemskerk","heerde","hendrikidoambacht","hilvarenbeek","hilversum","hollandskroon","hulst","katwijk","krimpenadijssel","krimpenerwaard","landsmeer","leeuwarden","leiden","leiderdorp","leusden","lingewaard","loonopzand","losser","maassluis","maastricht","medemblik","meierijstad","meppel","moerdijk","molenwaard","nieuwegein","nieuwkoop","nijkerk","noordoostpolder","noordwijk","noordwijkerhout","oisterwijk","oldambt","ommen","oosterhout","oostgelre","oss","oude_ijsselstreek","overbetuwe","raalte","rheden","rhenen","rijswijk","roermond","roosendaal","rucphen","schagen","schiedam","soest","staphorst","steenbergen","steenwijkerland","stichtsevecht","texel","teylingen","utrecht","veenendaal","velsen","vlaardingen","vlissingen","voorschoten","voorst","waalwijk","wageningen","wassenaar","zaanstad","zandvoort","zeist","zoetermeer","zwartewaterland","zwolle"]},types:{terms:["events","motions","vote_events"]},classification:{terms:["Agendapunt","Agenda","Ingekomen stukken","Toezeggingen","Moties","Schriftelijke vragen","Raadsbrieven","Verslag","Commissiebrieven S&R", "Toezeggingen S&R","Amendementen","Besluitenlijst B&W","Toezeggingen M&S","Commissiebrieven M&S","Raadsvragen","Schriftelijke vragen (export)","Gemeentebladen","Schriftelijke Vragen","Toezeggingen Raad","Uitnodigingen","RSS","Voortganglijst/toezeggingen" ,"Brieven aan de raad","Informatie","Informatieve Stukken College","Stemmingen","Persberichten","Raadsverslagen","Artikel 44 vragen","Informatie van het college","Verslagen S&R","Collegebrieven","Aangeleverde raadsvoorstellen","Aanbevelingen onderzoeken","Brieven B&W aan raad","Besluitenlijsten raad","Griffie-info documenten","Besluitenlijsten college van B&W","Technische vragen","Besluitenlijst Raad","Rapport","Raadsmededelingen & Memo's","Memo's","Informatienota's","Memo actieve raadsinformatie","Overige raadsinformatie","B&W besluiten","Vragen aan het college","Weekmail","Standpuntenlijsten commissie(s)","Artikel 45 vragen","Artikel 32 vragen","Vragen","Besluitenlijsten (B&W)","Genomen raadsbesluiten","Raadsvragen en antwoorden","College besluitenlijsten","Beantwoorde raadsvragen","Report","Besluitenlijsten college","Verslagen M&S","Dossiers","Notulen raad","Besluitenlijsten van de raad","Vastgesteld beleid","Rekenkamerrapporten","Schriftelijke vragen (artikel 41 RvO)","Besluitenlijsten","Verslag B&W","Vergaderstukken gemeenschappelijke regelingen", "Collegevoorstellen (ter informatie)","Raadsvragen Schriftelijke","Verslagen Raad","export","Brieven aan de raad  Openbaar","Besluitenlijst","Collegeberichten","agendapunt_actielijst","Besluitenlijst raad","Raadsbesluiten","Besluitenlijst PS","Politieke vragen","Videotulen Commissie Stad en Ruimte","Openbare besluitenlijsten college","Notulen","Raadsinformatie","Videotulen Raadsvergadering ","Schriftelijke vragen art. 18","Besluitenlijsten B&W","Verslagen Vragenuur","Griffie-info","Schriftelijke vragen art. 41","Sjabloonvragen","Verslag Raad","Videotulen Commissie Mens en Samenleving","Raadsjournaal","Besluitenlijsten Raad","Mondelinge Vragen","Videotulen Gemeenteraad","Resolution"]},start_date:{from:start_date,to:end_date}}, facets:{start_date:{interval:"year"}},sort:"start_date",order:"desc"}
							    options = window.LZString.compressToBase64(JSON.stringify(options)).split('/').join('-')

							    window.open(
							    	'http://zoek.openraadsinformatie.nl/#/g/'+d.country.toLowerCase()+'/search/' +query+'/options/'+options,
							    	'_blank' // <- This is what makes it open in a new window.
						    	);
							   
							});;
						}


					d3.select(".mainGroup").selectAll(".bar-label")
			            .data(data)
			            .enter()
			            .append("text")
			            .classed("bar-label", true);  	

			        d3.select(".mainGroup").selectAll(".bar-label")
			            .attr("x", function (d, i) {return main_xScale(d.value) + main_yScale.rangeBand()})
			            .attr("y", function (d, i) {return main_yScale(d.country)})
			            .attr("dy", 15)
			            .text(function (d, i) {return d.value})
			            .on('click', function(d) {
					    	var options = {filters:{collection:{terms:["aalsmeer","alkmaar","almelo","almere","amersfoort","amstelveen","amsterdam","arnhem","baarn","barneveld","beemster","binnenmaas","bodegravenreeuwijk","borne","boxmeer","buren","cappelleadijssel","castricum", "culemborg","den_helder","denhaag","deventer","dewolden","diemen","doetinchem","dongen","drimmelen","edamvolendam","ede","emmen","enschede","epe","ettenleur","goirle","gouda","groningen","hardenberg","heemskerk","heerde","hendrikidoambacht","hilvarenbeek","hilversum","hollandskroon","hulst","katwijk","krimpenadijssel","krimpenerwaard","landsmeer","leeuwarden","leiden","leiderdorp","leusden","lingewaard","loonopzand","losser","maassluis","maastricht","medemblik","meierijstad","meppel","moerdijk","molenwaard","nieuwegein","nieuwkoop","nijkerk","noordoostpolder","noordwijk","noordwijkerhout","oisterwijk","oldambt","ommen","oosterhout","oostgelre","oss","oude_ijsselstreek","overbetuwe","raalte","rheden","rhenen","rijswijk","roermond","roosendaal","rucphen","schagen","schiedam","soest","staphorst","steenbergen","steenwijkerland","stichtsevecht","texel","teylingen","utrecht","veenendaal","velsen","vlaardingen","vlissingen","voorschoten","voorst","waalwijk","wageningen","wassenaar","zaanstad","zandvoort","zeist","zoetermeer","zwartewaterland","zwolle"]},types:{terms:["events","motions","vote_events"]},classification:{terms:["Agendapunt","Agenda","Ingekomen stukken","Toezeggingen","Moties","Schriftelijke vragen","Raadsbrieven","Verslag","Commissiebrieven S&R", "Toezeggingen S&R","Amendementen","Besluitenlijst B&W","Toezeggingen M&S","Commissiebrieven M&S","Raadsvragen","Schriftelijke vragen (export)","Gemeentebladen","Schriftelijke Vragen","Toezeggingen Raad","Uitnodigingen","RSS","Voortganglijst/toezeggingen" ,"Brieven aan de raad","Informatie","Informatieve Stukken College","Stemmingen","Persberichten","Raadsverslagen","Artikel 44 vragen","Informatie van het college","Verslagen S&R","Collegebrieven","Aangeleverde raadsvoorstellen","Aanbevelingen onderzoeken","Brieven B&W aan raad","Besluitenlijsten raad","Griffie-info documenten","Besluitenlijsten college van B&W","Technische vragen","Besluitenlijst Raad","Rapport","Raadsmededelingen & Memo's","Memo's","Informatienota's","Memo actieve raadsinformatie","Overige raadsinformatie","B&W besluiten","Vragen aan het college","Weekmail","Standpuntenlijsten commissie(s)","Artikel 45 vragen","Artikel 32 vragen","Vragen","Besluitenlijsten (B&W)","Genomen raadsbesluiten","Raadsvragen en antwoorden","College besluitenlijsten","Beantwoorde raadsvragen","Report","Besluitenlijsten college","Verslagen M&S","Dossiers","Notulen raad","Besluitenlijsten van de raad","Vastgesteld beleid","Rekenkamerrapporten","Schriftelijke vragen (artikel 41 RvO)","Besluitenlijsten","Verslag B&W","Vergaderstukken gemeenschappelijke regelingen", "Collegevoorstellen (ter informatie)","Raadsvragen Schriftelijke","Verslagen Raad","export","Brieven aan de raad  Openbaar","Besluitenlijst","Collegeberichten","agendapunt_actielijst","Besluitenlijst raad","Raadsbesluiten","Besluitenlijst PS","Politieke vragen","Videotulen Commissie Stad en Ruimte","Openbare besluitenlijsten college","Notulen","Raadsinformatie","Videotulen Raadsvergadering ","Schriftelijke vragen art. 18","Besluitenlijsten B&W","Verslagen Vragenuur","Griffie-info","Schriftelijke vragen art. 41","Sjabloonvragen","Verslag Raad","Videotulen Commissie Mens en Samenleving","Raadsjournaal","Besluitenlijsten Raad","Mondelinge Vragen","Videotulen Gemeenteraad","Resolution"]},start_date:{from:start_date,to:end_date}}, facets:{start_date:{interval:"year"}},sort:"start_date",order:"desc"}
						    options = window.LZString.compressToBase64(JSON.stringify(options)).split('/').join('-')

						    window.open(
						    	'http://zoek.openraadsinformatie.nl/#/g/'+d.country.toLowerCase()+'/search/' +query+'/options/'+options,
						    	'_blank' // <- This is what makes it open in a new window.
					    	);
						   
						})	
			            .style("fill", "black")
			            .style("text-anchor", "middle");

					//EXIT
					bar.exit()
						.remove();

					document.getElementById("loader").style.display = "none"; // Turn off the loader, as we are loaded
					document.getElementById("VrijeZoeker").disabled = false; // allow new query, as we have the right information
					document.getElementById("OnderwerpenZoeker").disabled = false; // allow new query, as we have the right information


				}//update

				/////////////////////////////////////////////////////////////
				////////////////////// Brush functions //////////////////////
				/////////////////////////////////////////////////////////////

				//First function that runs on a brush move
				function brushmove(data, newdata,query) {

						var extent = brush.extent();

						//Reset the part that is visible on the big chart
						var originalRange = main_yZoom.range();
						main_yZoom.domain( extent );

						/////////////////////////////////////////////////////////////
						///////////////////// Update the axis ///////////////////////
						/////////////////////////////////////////////////////////////

						//Update the domain of the x & y scale of the big bar chart
						main_yScale.domain(data.map(function(d) { return d.country; }));
						main_yScale.rangeBands( [ main_yZoom(originalRange[0]), main_yZoom(originalRange[1]) ], 0.4, 0);

						//Update the y axis of the big chart
						d3.select(".mainGroup")
							.select(".y.axis")
							.call(main_yAxis);

						/////////////////////////////////////////////////////////////
						/////////////// Update the mini bar fills ///////////////////
						/////////////////////////////////////////////////////////////

						//Update the colors within the mini bar chart
						var selected = mini_yScale.domain()
						  .filter(function(d) { return (extent[0] - mini_yScale.rangeBand() + 1e-2 <= mini_yScale(d)) && (mini_yScale(d) <= extent[1] - 1e-2); }); 
						//Update the colors of the mini chart - Make everything outside the brush grey
						
						if (newdata){ //fill with the right color, based on value
							d3.select(".miniGroup").selectAll(".bar")
								.data(data, function(d) {return d.key; })
							  	.style("fill", function (d,i) {
					                return linearColorScale(i);
				            	});
						}

						//Update the big bar chart
						update(data, newdata,query);

				}//brushmove

				/////////////////////////////////////////////////////////////
				////////////////////// Click functions //////////////////////
				/////////////////////////////////////////////////////////////

				//Based on https://bl.ocks.org/mbostock/6498000
				//What to do when the user clicks on another location along the brushable bar chart
				function brushcenter() {
				var target = d3.event.target,
				    extent = brush.extent(),
				    size = extent[1] - extent[0],
				    range = mini_yScale.range(),
				    y0 = d3.min(range) + size / 2,
				    y1 = d3.max(range) + mini_yScale.rangeBand() - size / 2,
				    center = Math.max( y0, Math.min( y1, d3.mouse(target)[1] ) );

				d3.event.stopPropagation();

				gBrush
				    .call(brush.extent([center - size / 2, center + size / 2]))
				    .call(brush.event);

				}//brushcenter

				/////////////////////////////////////////////////////////////
				///////////////////// Scroll functions //////////////////////
				/////////////////////////////////////////////////////////////

				function scroll() {

					//Mouse scroll on the mini chart
					var extent = brush.extent(),
						size = extent[1] - extent[0],
						range = mini_yScale.range(),
						y0 = d3.min(range),
						y1 = d3.max(range) + mini_yScale.rangeBand(),
						dy = -d3.event.deltaY,
						topSection;

					if ( extent[0] - dy < y0 ) { topSection = y0; } 
					else if ( extent[1] - dy > y1 ) { topSection = y1 - size; } 
					else { topSection = extent[0] - dy; }

					//Make sure the page doesn't scroll as well
					d3.event.stopPropagation();
					d3.event.preventDefault();

					gBrush
					    .call(brush.extent([ topSection, topSection + size ]))
					    .call(brush.event);

				}//scroll
			}
		</script>
	</div>
</div>
</html>